<!DOCTYPE html>
<html lang="de-de"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="content-type" content="text/html">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title itemprop="name">vSAN Node aktualisiert &#34;unicastagent list&#34; nicht automatisch nach Shutdown | blog.vi-universe.de</title>
<meta property="og:title" content="vSAN Node aktualisiert &#34;unicastagent list&#34; nicht automatisch nach Shutdown | blog.vi-universe.de" />
<meta name="twitter:title" content="vSAN Node aktualisiert &#34;unicastagent list&#34; nicht automatisch nach Shutdown | blog.vi-universe.de" />
<meta itemprop="name" content="vSAN Node aktualisiert &#34;unicastagent list&#34; nicht automatisch nach Shutdown | blog.vi-universe.de" />
<meta name="application-name" content="vSAN Node aktualisiert &#34;unicastagent list&#34; nicht automatisch nach Shutdown | blog.vi-universe.de" />
<meta property="og:site_name" content="blog.vi-universe.de" />

<meta name="description" content="vi-universe.de | Christian Kremer">
<meta itemprop="description" content="vi-universe.de | Christian Kremer" />
<meta property="og:description" content="vi-universe.de | Christian Kremer" />
<meta name="twitter:description" content="vi-universe.de | Christian Kremer" />

<meta property="og:locale" content="de-de" />
<meta name="language" content="de-de" />

  <link rel="alternate" hreflang="de-de" href="http://localhost:1313/posts/vsan_node_unicastagentlist/" title="German" />





    
    
    

    <meta property="og:type" content="article" />
    <meta property="og:article:published_time" content=2023-01-29T00:00:00Z />
    <meta property="article:published_time" content=2023-01-29T00:00:00Z />
    <meta property="og:url" content="http://localhost:1313/posts/vsan_node_unicastagentlist/" />

    
    <meta property="og:article:author" content="Christian Kremer" />
    <meta property="article:author" content="Christian Kremer" />
    <meta name="author" content="Christian Kremer" />
    
    

    

    <script defer type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "vSAN Node aktualisiert \"unicastagent list\" nicht automatisch nach Shutdown",
        "author": {
        "@type": "Person",
        "name": ""
        },
        "datePublished": "2023-01-29",
        "description": "",
        "wordCount":  423 ,
        "mainEntityOfPage": "True",
        "dateModified": "2023-01-29",
        "image": {
        "@type": "imageObject",
        "url": ""
        },
        "publisher": {
        "@type": "Organization",
        "name": "blog.vi-universe.de"
        }
    }
    </script>


<meta name="generator" content="Hugo 0.147.8">

    
    <meta property="og:url" content="http://localhost:1313/posts/vsan_node_unicastagentlist/">
  <meta property="og:site_name" content="blog.vi-universe.de">
  <meta property="og:title" content="vSAN Node aktualisiert &#34;unicastagent list&#34; nicht automatisch nach Shutdown">
  <meta property="og:description" content="Hin und wieder muss man für Wartungsarbeiten etc. seine vSAN Umgebung herunterfahren. Normalerweise ist dieser Vorgang nicht unbedingt kritisch, dennoch bin ich in letzter Zeit öfters darüber gestolpert, dass ein vSAN Node seine Partner nicht mehr gefunden hat.
vSAN Umgebung Die vSAN Umgebung umfasst 8 vSAN Nodes als Stretched Cluster &#43; Witness. Also 4&#43;4&#43;N.
Die Ausgangslage Nach einem “Cluster Shutdown” fanden nur noch 7 von 8 Nodes ihre vSAN-Partner.
Auf meinem Screenshot erkennt man die “Command-Ausgabe” von Node04.
In der Zeile “Sub-Cluster Member HostName” ist deutlich zu erkennen das seine vSAN Partner fehlen.">
  <meta property="og:locale" content="de_de">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-01-29T00:00:00+00:00">
    <meta property="article:modified_time" content="2023-01-29T00:00:00+00:00">


    
    
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="vSAN Node aktualisiert &#34;unicastagent list&#34; nicht automatisch nach Shutdown">
  <meta name="twitter:description" content="Hin und wieder muss man für Wartungsarbeiten etc. seine vSAN Umgebung herunterfahren. Normalerweise ist dieser Vorgang nicht unbedingt kritisch, dennoch bin ich in letzter Zeit öfters darüber gestolpert, dass ein vSAN Node seine Partner nicht mehr gefunden hat.
vSAN Umgebung Die vSAN Umgebung umfasst 8 vSAN Nodes als Stretched Cluster &#43; Witness. Also 4&#43;4&#43;N.
Die Ausgangslage Nach einem “Cluster Shutdown” fanden nur noch 7 von 8 Nodes ihre vSAN-Partner.
Auf meinem Screenshot erkennt man die “Command-Ausgabe” von Node04.
In der Zeile “Sub-Cluster Member HostName” ist deutlich zu erkennen das seine vSAN Partner fehlen.">


    

    <link rel="canonical" href="http://localhost:1313/posts/vsan_node_unicastagentlist/">
    <link href="/style.min.cf5e90893fe6ed558990ae94c193d330841d6aabc33aa8f6f65ef6e15b25378e.css" rel="stylesheet">
    <link href="/code-highlight.min.706d31975fec544a864cb7f0d847a73ea55ca1df91bf495fd12a177138d807cf.css" rel="stylesheet">

    
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg">
    <link rel="shortcut icon" href="/favicon.ico">




<link rel="manifest" href="http://localhost:1313/site.webmanifest">

<meta name="msapplication-config" content="/browserconfig.xml">
<meta name="msapplication-TileColor" content="#2d89ef">
<meta name="theme-color" content="#434648">

    
    <link rel="icon" type="image/svg+xml" href="/icons/favicon.svg">

    
    
</head>
<body data-theme = "auto" class="notransition">

<script src="/js/theme.js"></script>

<div class="navbar" role="navigation">
    <nav class="menu" aria-label="Main Navigation">
        <a href="http://localhost:1313/" class="logo">
            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" 
viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" 
stroke-linejoin="round" class="feather feather-home">
<title>Startseite</title>
<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
<polyline points="9 22 9 12 15 12 15 22"></polyline>
</svg>
        </a>
        <input type="checkbox" id="menu-trigger" class="menu-trigger" />
        <label for="menu-trigger">
            <span class="menu-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" stroke="currentColor" fill="none" viewBox="0 0 14 14"><title>Menu</title><path stroke-linecap="round" stroke-linejoin="round" d="M10.595 7L3.40726 7"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 3.51488L3.49301 3.51488"></path><path stroke-linecap="round" stroke-linejoin="round" d="M10.5096 10.4851H3.49301"></path><path stroke-linecap="round" stroke-linejoin="round" d="M0.5 12.5V1.5C0.5 0.947715 0.947715 0.5 1.5 0.5H12.5C13.0523 0.5 13.5 0.947715 13.5 1.5V12.5C13.5 13.0523 13.0523 13.5 12.5 13.5H1.5C0.947715 13.5 0.5 13.0523 0.5 12.5Z"></path></svg>
            </span>
        </label>

        <div class="trigger">
            <ul class="trigger-container">
                
                
                <li>
                    <a class="menu-link " href="/">
                        Startseite
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link active" href="/posts/">
                        Beiträge
                    </a>
                    
                </li>
                
                <li>
                    <a class="menu-link " href="/pages/about/">
                        Über mich
                    </a>
                    
                </li>
                
                <li class="menu-separator">
                    <span>|</span>
                </li>
                
                
            </ul>
            <a id="mode" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-sunny" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>LIGHT</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
                <svg xmlns="http://www.w3.org/2000/svg" class="mode-moon" width="21" height="21" viewBox="0 0 14 14" stroke-width="1">
<title>DARK</title><g><circle cx="7" cy="7" r="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></circle><line x1="7" y1="0.5" x2="7" y2="2.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="2.4" x2="3.82" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="0.5" y1="7" x2="2.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="2.4" y1="11.6" x2="3.82" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="7" y1="13.5" x2="7" y2="11.5" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="11.6" x2="10.18" y2="10.18" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="13.5" y1="7" x2="11.5" y2="7" fill="none" stroke-linecap="round" stroke-linejoin="round"></line><line x1="11.6" y1="2.4" x2="10.18" y2="3.82" fill="none" stroke-linecap="round" stroke-linejoin="round"></line></g></svg>
            </a>
        </div>
    </nav>
</div>

<div class="wrapper post">
    <main class="page-content" aria-label="Content">
        <article>
            <header class="header">
                <h1 class="header-title">vSAN Node aktualisiert &#34;unicastagent list&#34; nicht automatisch nach Shutdown</h1>
                
                
                
                <div class="post-meta">
                    <time datetime="2023-01-29T00:00:00&#43;00:00" itemprop="datePublished"> 29.01.2023 </time>
                </div>
                
            </header>
            
    
    <details class="toc" ZgotmplZ>
        <summary><b>Inhaltsverzeichnis</b></summary>
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#vsan-umgebung">vSAN Umgebung</a></li>
        <li><a href="#die-ausgangslage">Die Ausgangslage</a></li>
        <li><a href="#zu-diesem-zeitpunkt-waren-keine-vms-gestartet-und-alle-nodes-im-wartungsmodus">Zu diesem Zeitpunkt waren keine VMs gestartet und alle Nodes im Wartungsmodus</a></li>
        <li><a href="#node04-selbst-darf-nicht-eingetragen-werden">Node04 selbst darf nicht eingetragen werden</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </details>
            <div class="page-content">
                <p>Hin und wieder muss man für Wartungsarbeiten etc. seine vSAN Umgebung herunterfahren.
Normalerweise ist dieser Vorgang nicht unbedingt kritisch, dennoch bin ich in letzter Zeit öfters darüber gestolpert, dass ein vSAN Node seine Partner nicht mehr gefunden hat.</p>
<h3 id="vsan-umgebung">vSAN Umgebung</h3>
<p>Die vSAN Umgebung umfasst 8 vSAN Nodes als Stretched Cluster + Witness. Also 4+4+N.</p>
<h3 id="die-ausgangslage">Die Ausgangslage</h3>
<p>Nach einem &ldquo;Cluster Shutdown&rdquo; fanden nur noch 7 von 8 Nodes ihre vSAN-Partner.<br>
Auf meinem Screenshot erkennt man die &ldquo;Command-Ausgabe&rdquo; von Node04.<br>
In der Zeile &ldquo;Sub-Cluster Member HostName&rdquo; ist deutlich zu erkennen das seine vSAN Partner fehlen.</p>
<figure><a href="01.jpg"><img src="/vsan_node_unicastagentlist/01.jpg"
    alt="vSAN CLI Output"></a><figcaption>
      <p>vSAN CLI Output- Klick zum vergrößern</p>
    </figcaption>
</figure>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">esxcli vsan cluster get
</span></span></code></pre></div><p>Der Blick in die &ldquo;Unicastagent list&rdquo; bestätigt dies. Normalerweiße sollten hier alle Nodes aufgeführt sein, außer der jeweilige Node selbst.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">esxcli vsan cluster unicastagent list
</span></span></code></pre></div><p>Also gut&hellip; Was gilt es zu überprüfen.</p>
<p>Mit diesem Command lasse ich mir meine Netzwerk-Interface anzeigen um zu überprüfen ob der Link Status &ldquo;Up&rdquo; ist.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">esxcli network nic list
</span></span></code></pre></div><p>Anschließend lasse ich mir anzeigen auf welchem VMKernel Port vSAN Traffic aktiviert ist.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">esxcli vsan network list
</span></span></code></pre></div><p>VMK3 Traffic Type: vSAN<br></p>
<p>Mit dieser Information, kann ich mit folgenden Befehl überprüfen, ob mein Node04 über das vSAN Netzwerk alle anderen Nodes erreicht.
So far so good - Ich konnte über VMKernelport vmk3 alle anderen Nodes inkl. Witness erreichen.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vmkping -I vmk3 *IP VMK3 der anderen Nodes*
</span></span></code></pre></div><p>Beide Interfaces &ldquo;Up&rdquo; - vmkping auch erfolgreich.</p>
<p>Dann helfen wir Node04 manuell auf die Beine.</p>
<h3 id="zu-diesem-zeitpunkt-waren-keine-vms-gestartet-und-alle-nodes-im-wartungsmodus">Zu diesem Zeitpunkt waren keine VMs gestartet und alle Nodes im Wartungsmodus</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">esxcli system maintenanceMode <span class="nb">set</span> -e <span class="nb">true</span> -m noAction
</span></span></code></pre></div><p>Dieser Command deaktiviert temporär die automatischen Updates der Unicastagent List.</p>
<p>Diesen Command führe ich auf allen Nodes im Cluster aus.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">esxcfg-advcfg -s <span class="m">1</span> /VSAN/IgnoreClusterMemberListupdates
</span></span></code></pre></div><p>Nachdem ich auf allen Nodes, dass automatische Update deaktiviert habe, notiere ich mir die UUID aller Nodes in Notepad.
Folgender Befehl gibt mir die Host_UUID aus.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">cmmds-tool whoami
</span></span></code></pre></div><p>Nun füge ich auf meinem betroffen Node04 alle anderen vSAN Partner manuell hinzu.</p>
<h3 id="node04-selbst-darf-nicht-eingetragen-werden">Node04 selbst darf nicht eingetragen werden</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">esxcli vsan cluster unicastagent add -t node -u &lt;Host_UUID&gt; -U <span class="nb">true</span> -a &lt;Host_VSAN_IP&gt; -p <span class="m">12321</span>
</span></span></code></pre></div><p>Um den vSAN-Witness hinzuzufügen, muss der Command etwas geändert werden.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">esxcli vsan cluster unicastagent add -t witness -u &lt;Host_UUID&gt; -U <span class="nb">true</span> -a &lt;Host_VSAN_IP&gt; -p <span class="m">12321</span>
</span></span></code></pre></div><p>Mal sehen ob wieder alle vSAN Partner am Start sind ;)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">esxcli vsan cluster get
</span></span></code></pre></div><p>Danach muss wieder das automatische Update der Unicastagent List aktiviert werden.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">esxcfg-advcfg -s <span class="m">0</span> /VSAN/IgnoreClusterMemberListupdates
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">esxcli vsan cluster get
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">esxcli vsan cluster unicastagent list
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">esxcli network nic list-&gt; esxcli vsan network list
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vmkping -I vmk3 *IP VMK3 der anderen Nodes*
</span></span></code></pre></div>
            </div>
        </article></main>
</div>
<footer class="footer">
    <span class="footer_item"> </span>
    &nbsp;

    <div class="footer_social-icons">
<a href="https://github.com/vi-universe" target="_blank" rel="noopener noreferrer me"
    title="Github">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
</a>
<a href="https://www.linkedin.com/in/christian-kremer-it" target="_blank" rel="noopener noreferrer me"
    title="LinkedIn">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
    <rect x="2" y="9" width="4" height="12"></rect>
    <circle cx="4" cy="4" r="2"></circle>
</svg>
</a>
<a href="/index.xml" target="_blank" rel="noopener noreferrer me"
    title="Rss">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 11a9 9 0 0 1 9 9" />
    <path d="M4 4a16 16 0 0 1 16 16" />
    <circle cx="5" cy="19" r="1" />
</svg>
</a>
</div>
    <small class="footer_copyright">
        © 2025 Christian Kremer.
        Unterstützt durch <a href="https://github.com/hugo-sid/hugo-blog-awesome" target="_blank" rel="noopener">Hugo blog awesome</a>.
    </small>
</footer><a href="#" title="Zum Seitenanfang" id="totop">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" stroke="currentColor" viewBox="0 96 960 960">
    <path d="M283 704.739 234.261 656 480 410.261 725.739 656 677 704.739l-197-197-197 197Z"/>
</svg>

</a>


    




    
    
        
    

    
    
        
    



    
    <script async src="http://localhost:1313/js/main.js" ></script>

    

</body>
</html>
